import ipywidgets.widgets as widgets
controller = widgets.Controller(index=0)  # replace with index of your controller
display(controller)

from jetracer.nvidia_racecar import NvidiaRacecar
import traitlets
car = NvidiaRacecar()
import cv2
from IPython.display import display
from jetcam.csi_camera import CSICamera
def brg8_to_jpeg(value,quality=75):
    return bytes(cv2.imencode('.jpeg',value)[1])
camera = CSICamera(width=224, height=224, capture_fps=30)
image = widgets.Image(format='jpeg',width=224, height=224)
camera_link = traitlets.dlink((camera, 'value'),(image,'value'),transform=brg8_to_jpeg)
camera.running = True
display(image)

car.throttle_gain = 0.4
car.steering_offset= 0.0
car.steering = 0

direction = traitlets.dlink((controller.axes[2], 'value'), (car, 'steering'), transform=lambda x: -x)
accel = traitlets.dlink((controller.axes[1], 'value'), (car, 'throttle'), transform=lambda x: x)
